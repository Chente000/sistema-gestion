{# administrador/templates/administrador/panel_administrador.html #}

{% extends 'base.html' %} {# Asegúrate de que esta es la plantilla base correcta #}
{% load static %}

{% block content %}
<div class="d-flex" id="wrapper">
    <!-- Sidebar -->
    <div class="bg-light border-right" id="sidebar-wrapper">
        <div class="sidebar-heading">Panel Administrador</div>
        <div class="list-group list-group-flush">
            <a href="{% url 'administrador:panel_administrador' %}" class="list-group-item list-group-item-action bg-light">
                <i class="fas fa-tachometer-alt me-2"></i>Dashboard
            </a>

            {# Gestión de Usuarios #}
            {% if perms.administrador.manage_usuario %}
            <a href="#submenu-usuarios" data-bs-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action bg-light dropdown-toggle">
                <i class="fas fa-users me-2"></i>Gestión de Usuarios
            </a>
            <div class="collapse" id="submenu-usuarios">
                <a href="{% url 'administrador:usuarios_aprobados' %}" class="list-group-item list-group-item-action bg-light ps-5">Usuarios Aprobados</a>
                <a href="{% url 'administrador:revisar_solicitudes' %}" class="list-group-item list-group-item-action bg-light ps-5">Solicitudes de Registro</a>
            </div>
            {% endif %}

            {# Configuración General #}
            {% if perms.administrador.manage_configuracion_registro or perms.administrador.view_registro_cambios %}
            <a href="#submenu-config" data-bs-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action bg-light dropdown-toggle">
                <i class="fas fa-cogs me-2"></i>Configuración
            </a>
            <div class="collapse" id="submenu-config">
                {% if perms.administrador.manage_configuracion_registro %}
                <a href="{% url 'administrador:configurar_registro' %}" class="list-group-item list-group-item-action bg-light ps-5">Configuración de Registro</a>
                {% endif %}
                {% if perms.administrador.view_registro_cambios %}
                <a href="{% url 'administrador:registro_cambios' %}" class="list-group-item list-group-item-action bg-light ps-5">Registro de Cambios</a>
                {% endif %}
            </div>
            {% endif %}

            {# Gestión de Estructura Académica #}
            {% if perms.administrador.manage_facultad or perms.administrador.manage_departamento or perms.administrador.manage_carrera %}
            <a href="#submenu-estructura" data-bs-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action bg-light dropdown-toggle">
                <i class="fas fa-building me-2"></i>Estructura Académica
            </a>
            <div class="collapse" id="submenu-estructura">
                {% if perms.administrador.manage_facultad %}
                <a href="{% url 'administrador:lista_facultades' %}" class="list-group-item list-group-item-action bg-light ps-5">Facultades</a>
                {% endif %}
                {% if perms.administrador.manage_departamento %}
                <a href="{% url 'administrador:lista_departamentos' %}" class="list-group-item list-group-item-action bg-light ps-5">Departamentos</a>
                {% endif %}
                {% if perms.administrador.manage_carrera %}
                <a href="{% url 'administrador:lista_carrera' %}" class="list-group-item list-group-item-action bg-light ps-5">Carreras</a>
                {% endif %}
            </div>
            {% endif %}

            {# Gestión de Recursos #}
            {% if perms.administrador.manage_aula or perms.administrador.manage_tipo_aula or perms.administrador.manage_periodo or perms.administrador.manage_cargos %} {# Agregado 'manage_cargos' #}
            <a href="#submenu-recursos" data-bs-toggle="collapse" aria-expanded="false" class="list-group-item list-group-item-action bg-light dropdown-toggle">
                <i class="fas fa-box me-2"></i>Recursos
            </a>
            <div class="collapse" id="submenu-recursos">
                {% if perms.administrador.manage_periodo %}
                <a href="{% url 'administrador:lista_periodos' %}" class="list-group-item list-group-item-action bg-light ps-5">Períodos Académicos</a>
                {% endif %}
                {% if perms.administrador.manage_cargos %} {# Nuevo elemento del menú para Cargos #}
                <a href="{% url 'administrador:lista_cargos' %}" class="list-group-item list-group-item-action bg-light ps-5">Cargos</a>
                {% endif %}
            </div>
            {% endif %}

            {# ... (otros elementos del menú) ... #}

        </div>
    </div>
    <!-- /#sidebar-wrapper -->

    <!-- Page Content -->
    <div id="page-content-wrapper">
        <nav class="navbar navbar-expand-lg navbar-light bg-light border-bottom">
            <button class="btn btn-primary" id="menu-toggle">Toggle Menu</button>

            <button class="navbar-toggler" type="button" data-bs-toggle="collapse" data-bs-target="#navbarSupportedContent" aria-controls="navbarSupportedContent" aria-expanded="false" aria-label="Toggle navigation">
                <span class="navbar-toggler-icon"></span>
            </button>

            <div class="collapse navbar-collapse" id="navbarSupportedContent">
                <ul class="navbar-nav ms-auto mt-2 mt-lg-0">
                    <li class="nav-item active">
                        <a class="nav-link" href="#">Inicio <span class="sr-only">(current)</span></a>
                    </li>
                    <li class="nav-item dropdown">
                        <a class="nav-link dropdown-toggle" href="#" id="navbarDropdown" role="button" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false">
                            {{ request.user.username }}
                        </a>
                        <div class="dropdown-menu dropdown-menu-end" aria-labelledby="navbarDropdown">
                            <a class="dropdown-item" href="">Perfil</a> <!-- Asegúrate de que 'perfil' es una URL válida en tu proyecto -->
                            <a class="dropdown-item" href="#">Configuración</a>
                            <div class="dropdown-divider"></div>
                            <a class="dropdown-item" href="{% url 'accounts:cerrar_sesion' %}">Cerrar Sesión</a>
                        </div>
                    </li>
                </ul>
            </div>
        </nav>

        <div class="container-fluid">
            {% block content_admin_panel %}
            {# Contenido específico de cada página se insertará aquí #}
            {% endblock content_admin_panel %}
        </div>
    </div>
    <!-- /#page-content-wrapper -->
</div>
<!-- /#wrapper -->

{% endblock content %}

{% block extra_js %}
<script>
    var el = document.getElementById("wrapper");
    var toggleButton = document.getElementById("menu-toggle");

    toggleButton.onclick = function () {
        el.classList.toggle("toggled");
    };
</script>
{% endblock extra_js %}
